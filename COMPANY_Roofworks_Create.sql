Use Master

If Exists (Select * from sys.databases where name = 'COMPANY_Roofworks_dbo')
DROP DATABASE COMPANY_Roofworks_dbo

Create Database COMPANY_Roofworks_dbo

USE COMPANY_Roofworks_dbo

CREATE TABLE PROVINCE(
PROVINCE_ID varchar(5) NOT NULL PRIMARY KEY,
PROVINCE_NAME varchar(40) NOT NULL
);

CREATE TABLE CUSTOMER(
CUSTOMER_ID varchar(5) NOT NULL PRIMARY KEY,
CUSTOMER_NAME varchar(40) NOT NULL,
CUSTOMER_STREET varchar(40) NOT NULL,
PROVINCE_ID varchar(5) FOREIGN KEY REFERENCES PROVINCE(PROVINCE_ID),
CUSTOMER_POSTALCODE VARCHAR(5) NOT NULL 
);

CREATE TABLE EMPLOYEE(
EMPLOYEE_NUMBER varchar(6) NOT NULL PRIMARY KEY,
EMPLOYEE_NAME varchar(40) NOT NULL,
);

CREATE TABLE JOBTYPE(
JOBTYPE_ID varchar(5) NOT NULL PRIMARY KEY,
JOBTYPE_TYPE varchar(40) NOT NULL,
JOBTYPE_DAILYRATE NUMERIC(5) NOT NULL
);

CREATE TABLE JOB(
JOB_JOBCARD varchar(5) NOT NULL PRIMARY KEY,
JOBTYPE_ID varchar(5) FOREIGN KEY REFERENCES JOBTYPE(JOBTYPE_ID),
JOB_DAYS SMALLINT NOT NULL,
);

CREATE TABLE INVENTORY(
INVENTORY_ID varchar(5) NOT NULL PRIMARY KEY,
INVENTORY_MATERIALNAME varchar(40) NOT NULL,
INVENTORY_INSTOCK SMALLINT NOT NULL
);

CREATE TABLE INVOICELINE(
INVOICELINE_ID varchar(5) NOT NULL PRIMARY KEY
);

CREATE TABLE MATERIALS(
INVOICELINE_ID varchar(5) FOREIGN KEY REFERENCES INVOICELINE(INVOICELINE_ID),
INVENTORY_ID varchar(5) FOREIGN KEY REFERENCES INVENTORY(INVENTORY_ID),
MATERIALS_USED SMALLINT NOT NULL
);

CREATE TABLE INVOICE(
EMPLOYEE_NUMBER varchar(6) FOREIGN KEY REFERENCES EMPLOYEE(EMPLOYEE_NUMBER),
INVOICELINE_ID varchar(5) FOREIGN KEY REFERENCES INVOICELINE(INVOICELINE_ID),
JOB_JOBCARD varchar(5) FOREIGN KEY REFERENCES JOB(JOB_JOBCARD),
CUSTOMER_ID varchar(5) FOREIGN KEY REFERENCES CUSTOMER(CUSTOMER_ID),
);

INSERT INTO PROVINCE VALUES 
('P0001','PRETORIA'),
('P0002','PRETORIA-WEST')

INSERT INTO CUSTOMER VALUES
('C0001','Tendai Ndoro','3 Leos Place 457 Church Str','P0001','0002'),
('C0002','Donald Puttingh','408 Oubos 368 Prinsloo Street','P0001','0001'),
('C0003','Tracy Samson ','206 Albertros 269 Stead Avenue','P0001','0186'),
('C0004','Jacob Smith','A201 Ocerton 269 Debouvlrde Str','P0001','0002'),
('C0005','Thato Molepo','11 Luttig Court 289 MALTZAN Str','P0001','0001'),
('C0006','Dakalo Mudau','1182 CEBINIA Str','P0001','0082'),
('C0007','Sfiso Myeni','503 Hamilton Gardens 337 Visagie Str','P0001','0001'),
('C0008','Ricardo Keyl','10 Silville 614 Jasmyn St','P0001','0184'),
('C0009','Smallboy Mtshali','307 FEORA East','P0002','0183'),
('C0010','Wilson Jansen','701 Monticchico Flat 251 Jacob Mare Str','P0001','0002')

INSERT INTO EMPLOYEE VALUES
('EMP100','Albert Malose'),
('EMP920','Chris Byne'),
('EMP010','John Hendriks'),
('EMP771','Smallboy Modipa'),
('EMP681','Stanley Jacobs')

INSERT INTO JOBTYPE VALUES
('JT001','Full Conversion','1200.00'),
('JT002','Semi Conversion','1080.00'),
('JT003','Floor Boarding','900.00')

INSERT INTO JOB VALUES 
('11000','JT001','7'),
('10478','JT002','2'),
('14253','JT003','2'),
('11258','JT001','8'),
('12058','JT002','3')

INSERT INTO INVENTORY VALUES 
('MT001','Standard Floor Boards','675'),
('MT002','Power Points','22'),
('MT003','Standard Electrical Wire','161'),
('MT004','Standard Stairs Pack','4')

INSERT INTO INVOICELINE VALUES
('INL01'),
('INL02'),
('INL03'),
('INL04'),
('INL05')

INSERT INTO MATERIALS VALUES 
('INL01','MT001','90'),
('INL01','MT002','3'),
('INL01','MT003','20'),
('INL01','MT004','1'),
('INL02','MT001','50'),
('INL02','MT002','1'),
('INL02','MT003','10'),
('INL03','MT001','40'),
('INL04','MT001','80'),
('INL04','MT002','3'),
('INL04','MT003','20'),
('INL04','MT004','1'),
('INL05','MT001','60'),
('INL05','MT002','2'),
('INL05','MT003','15')

INSERT INTO INVOICE VALUES
('EMP100','INL01','11000','C0001'),
('EMP920','INL01','11000','C0001'),
('EMP010','INL01','11000','C0001'),
('EMP920','INL02','10478','C0002'),
('EMP771','INL03','14253','C0003'),
('EMP681','INL04','11258','C0004'),
('EMP010','INL04','11258','C0004'),
('EMP771','INL04','11258','C0004'),
('EMP681','INL05','12058','C0005')

SELECT * FROM PROVINCE
SELECT * FROM CUSTOMER
SELECT * FROM EMPLOYEE
SELECT * FROM JOB
SELECT * FROM JOBTYPE
SELECT * FROM MATERIALS
SELECT * FROM INVENTORY
SELECT * FROM INVOICELINE
SELECT * FROM INVOICE

--Write a query that selects all the job cards and which employees have worked on them.
SELECT JOB_JOBCARD, emp.EMPLOYEE_NAME
FROM INVOICE inv
FULL JOIN EMPLOYEE emp
ON inv.EMPLOYEE_NUMBER=emp.EMPLOYEE_NUMBER

--Write a query that selects the materials that have been used on job cards of type ‘FullConversion’.
SELECT jbt.JOBTYPE_TYPE,inven.INVENTORY_MATERIALNAME,mat.MATERIALS_USED
FROM JOBTYPE jbt
JOIN JOB jb
ON jbt.JOBTYPE_ID = jb.JOBTYPE_ID
JOIN INVOICE inv
ON jb.JOB_JOBCARD = inv.JOB_JOBCARD
JOIN INVOICELINE invl
ON inv.INVOICELINE_ID = invl.INVOICELINE_ID
JOIN MATERIALS MAT
ON invl.INVOICELINE_ID = mat.INVOICELINE_ID
JOIN INVENTORY inven
ON mat.INVENTORY_ID= inven.INVENTORY_ID
WHERE jbt.JOBTYPE_TYPE = 'Full Conversion'

--Write a query that selects all the job cards that Chris Byne has worked on
SELECT JOB_JOBCARD, emp.EMPLOYEE_NAME
FROM INVOICE inv
FULL JOIN EMPLOYEE emp
ON inv.EMPLOYEE_NUMBER=emp.EMPLOYEE_NUMBER
WHERE emp.EMPLOYEE_NAME = 'Chris Byne'

-- Write a query that shows all job cards that have taken place in addresses that contain ‘0001’or ‘0002’.
SELECT JOB_JOBCARD, cus.CUSTOMER_POSTALCODE
FROM INVOICE inv
FULL JOIN CUSTOMER cus
ON inv.CUSTOMER_ID=cus.CUSTOMER_ID
WHERE cus.CUSTOMER_POSTALCODE= '0001' OR cus.CUSTOMER_POSTALCODE= '0002'
ORDER BY cus.CUSTOMER_POSTALCODE ASC

--Write a query that counts the number of jobsthat have used electrical wiring.
SELECT COUNT(INVENTORY_ID) AS JobsUsingElectricWiring FROM MATERIALS
WHERE MATERIALS.INVENTORY_ID = 'MT003'

--Write a query that produces the output that could be used to prepare an invoice. This shouldinclude a calculation for VAT charged on a job card (calculated at 14% of total cost of the jobcard).
SELECT jb.JOB_JOBCARD, cus.CUSTOMER_ID,cus.CUSTOMER_NAME,cus.CUSTOMER_POSTALCODE,cus.CUSTOMER_STREET,emp.EMPLOYEE_NAME,jbt.JOBTYPE_TYPE, mat.MATERIALS_USED, inven.INVENTORY_MATERIALNAME,jbt.JOBTYPE_TYPE,jbt.JOBTYPE_DAILYRATE,jb.JOB_DAYS, (jbt.JOBTYPE_DAILYRATE * jb.JOB_DAYS) AS SubTotal
FROM JOBTYPE jbt
JOIN JOB jb
ON jbt.JOBTYPE_ID = jb.JOBTYPE_ID
JOIN INVOICE inv
ON jb.JOB_JOBCARD = inv.JOB_JOBCARD
JOIN INVOICELINE invl
ON inv.INVOICELINE_ID = invl.INVOICELINE_ID
JOIN MATERIALS MAT
ON invl.INVOICELINE_ID = mat.INVOICELINE_ID
JOIN INVENTORY inven
ON mat.INVENTORY_ID= inven.INVENTORY_ID
JOIN EMPLOYEE emp
ON inv.EMPLOYEE_NUMBER = emp.EMPLOYEE_NUMBER
JOIN CUSTOMER CUS
ON inv.CUSTOMER_ID = cus.CUSTOMER_ID

--Update the daily rate of pay for a Full Conversion to R1 440.00.
UPDATE JOBTYPE
SET JOBTYPE_DAILYRATE = '1440.00'
WHERE JOBTYPE_ID = 'JT001';

SELECT * FROM JOBTYPE